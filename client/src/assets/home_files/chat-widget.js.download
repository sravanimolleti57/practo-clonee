var chatThing=function(){"use strict";var E=Object.defineProperty;var M=(g,h,a)=>h in g?E(g,h,{enumerable:!0,configurable:!0,writable:!0,value:a}):g[h]=a;var r=(g,h,a)=>M(g,typeof h!="symbol"?h+"":h,a);const g="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let h=(v=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(v|=0));for(;v--;)e+=g[t[v]&63];return e};const a=window;class w{constructor(){r(this,"config");r(this,"locales",["de","es","fr","it","jp","cn","el","pl","nl"]);r(this,"open",!1);r(this,"interfaceReady",!1);r(this,"payloads",[]);r(this,"messagePreview");r(this,"messagePreviewText",document.createElement("p"));r(this,"trigger",document.createElement("button"));r(this,"customTrigger",!1);r(this,"chatWindow");r(this,"chatWindowParent",document.body);r(this,"chatFrame",document.createElement("iframe"));r(this,"showMessagePreview",sessionStorage.getItem("showMessageBubble")==="true");r(this,"messagePreviewVisible",!1);r(this,"parser",new DOMParser);r(this,"powerUps",[]);var o,s;const e=document.currentScript;if(this.config=a.chatThingConfig||{},this.config.botId=this.config.botId||(e==null?void 0:e.dataset.botId)||(e==null?void 0:e.id),this.config.colour=this.config.colour||{},this.config.colour.widgetColour=this.config.colour.widgetColour||"rgb(17, 24, 39)",this.config.colour.widgetColourInverted=this.config.colour.widgetColourInverted||"rgb(255, 255, 255)",this.config.colour.primaryColour=this.config.colour.primaryColour||"rgb(79, 70, 229)",this.config.colour.primaryColourInverted=this.config.colour.primaryColourInverted||"rgb(255, 255, 255)",this.config.icon=this.config.icon||{},this.config.css=this.config.css||{},this.config.css.widget=this.config.css.widget||`position: fixed;
z-index: 999;
height: 60px;
width: 60px;
border-radius: 100%;
bottom: 20px;
right: 20px;
background: ${this.config.colour.widgetColour};
color: ${this.config.colour.widgetColourInverted};
box-shadow: 0px 4px 19px rgba(0,0,0,0.2);
border: none;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
overflow: hidden;
padding: 0px;`,this.config.svg=this.config.svg||{},this.config.svg.widget=this.config.svg.widget||`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="height: 40px; color: white;">
<path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
</svg>`,this.config.svg.close=this.config.svg.close||`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" style="height: 30px; color: white;">
<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
</svg>`,this.config.css.window=this.config.css.window||`position: fixed;
z-index: 999;
bottom: 100px;
right: 20px;
width: calc(100vw - 40px);
height: calc(100vh - 120px);
max-width: 400px;
max-height: 600px;
background: white;
border-radius: 8px;
background: rgb(17 24 39);
box-shadow: 0px 4px 19px rgba(0,0,0,0.2);
border: 1px solid rgba(255,255,255,0.1);
display: none;
overflow: hidden;`,this.config.css.iframe=this.config.css.iframe||`height: 100%;
width: 100%;
border: 0;`,this.config.css.messagePreviewContainer=this.config.css.messagePreviewContainer||`position: fixed;
z-index: 999;
bottom: 100px;
right: 20px;
transform: translateX(350px);
max-width: 300px;
display: flex;
flex-direction: column;
align-items: end;
gap: 10px;
margin-left: 20px;
transition: transform 0.2s ease-in-out;`,this.config.css.messagePreviewBox=this.config.css.messagePreviewBox||`border-radius: 8px;
background: ${this.config.theme==="dark"?"#1f2937":"#fff"};
color: ${this.config.theme==="dark"?"#d1d5dc":"#374151"};
box-shadow: 0px 4px 19px rgba(0,0,0,0.2);
padding: 15px;
display: flex;
gap: 15px;
cursor: pointer;`,this.config.css.messagePreviewIconImg=this.config.css.messagePreviewIconImg||`color: ${this.config.colour.primaryColourInverted};
padding: 5px;`,this.config.css.messagePreviewIconWrapper=this.config.css.messagePreviewIconWrapper||`background: ${this.config.colour.primaryColour};
border-radius: 100%;
overflow: hidden;
height: 25px;
aspect-ratio: 1;`,this.config.css.messagePreviewText=this.config.css.messagePreviewText||`margin: 2.5px 0;
font-family: Outfit, sans-serif;`,this.config.css.messagePreviewCloseIcon=this.config.css.messagePreviewCloseIcon||`width: 15px; 
aspect-ratio: 1;
color: white;`,this.config.css.messagePreviewCloseButton=this.config.css.messagePreviewCloseButton||`background: #b0acac;
padding: 0;
margin: 0;
border: unset;
line-height: 0;
border-radius: 100%;
padding: 3px;
cursor: pointer;
transition: visibility 0.1s linear, opacity 0.1s linear;`,this.config.css.customAssistantIcon=this.config.css.customAssistantIcon||`width:60px;
height:60px;`,this.config.css.bubbleCustomAssistantIcon=this.config.css.bubbleCustomAssistantIcon||`width:25px;
height:25px;`,this.config.url=this.config.url||"https://chatthing.ai",!this.config.botId){console.error("ChatThing: no bot id found");return}if((o=this.config.selectors)!=null&&o.widgetTrigger){const i=document.querySelector(this.config.selectors.widgetTrigger);i&&(this.trigger=i,this.customTrigger=!0)}if(this.customTrigger||(this.updateTriggerState(!1),this.trigger.style.cssText=this.config.css.widget,this.trigger.setAttribute("data-cy","button-chatthing"),this.trigger.setAttribute("aria-label","toggle chat window")),this.trigger.addEventListener("click",()=>{this.toggle()}),this.config.firstMessage){const i=document.createElement("link");i.rel="stylesheet",i.href="https://fonts.googleapis.com/css2?family=Outfit&display=swap",document.head.appendChild(i)}if(this.config.autoOpenDelay&&setTimeout(()=>{this.chatWindow||this.toggle()},this.config.autoOpenDelay),!this.showMessagePreview&&this.config.firstMessage&&this.showPreview(this.config.firstMessage),!this.customTrigger){const i=setInterval(()=>{document.body&&(document.body.appendChild(this.trigger),clearInterval(i))},250)}if(window.addEventListener("message",i=>{this.receiveMessageEvent(i)}),this.config.context){var t="";const i=new MutationObserver(()=>{location.href!==t&&(this._extendContext(this.config.context),t=location.href)});i.observe(document,{subtree:!0,childList:!0}),document.addEventListener("beforeunload",()=>{i.disconnect()})}if((s=this.config.selectors)!=null&&s.widgetWindowParent){const i=document.querySelector(this.config.selectors.widgetWindowParent);this.chatWindowParent=i||document.body,i||console.warn("ChatThing: window parent element not found, using document body")}}showPreview(e,t){typeof t>"u"&&(t=this.config.messagePreviewDelay||0),!(this.open||!e)&&(this.messagePreview?this.messagePreviewVisible?(this.slidePreviewOut(),setTimeout(()=>{this.messagePreviewText.innerText=e,this.slidePreviewIn()},200)):(this.messagePreviewText.innerText=e,this.slidePreviewIn()):(this.createPreview(e),setTimeout(()=>{this.slidePreviewIn()},t*1e3)))}hidePreview(){this.messagePreviewVisible&&this.slidePreviewOut()}show(){this.chatWindow||this.create(),!this.open&&this.chatWindow&&(this.updateTriggerState(!0),this.messagePreview&&(this.messagePreview.style.display="none"),this.chatWindow.style.display="block",this.open=!0)}hide(){this.open&&this.chatWindow&&(this.updateTriggerState(!1),this.chatWindow.style.display="none",this.open=!1)}toggle(){this.open?this.hide():this.show()}showTrigger(){this.trigger.style.visibility="visible"}hideTrigger(){this.trigger.style.visibility="hidden"}toggleTrigger(){this.trigger.style.visibility==="hidden"?this.showTrigger():this.hideTrigger()}sendMessage(e){this.sendMessageEvent({action:"send-message",message:e})}systemMessage(e,t){this.sendMessageEvent({action:`${e}-system-message`,message:t})}newConversation(e){this.sendMessageEvent({action:"new-conversation",message:e})}identifyUser(e){this.sendMessageEvent({action:"identify-user",data:e})}extendTheme(e){this.sendMessageEvent({action:"extend-theme",data:e})}extendContext(e){Object.keys(e).length?this.sendMessageEvent({action:"extend-context",data:e}):console.warn("ChatThing: extend context data is empty")}registerPowerUp(e){const t=`cp_${h().replace(/[-_]/g,"")}`,o=()=>{this.sendMessageEvent({action:"register-power-up",data:{...e,handler:void 0,id:t}})},s=()=>{this.sendMessageEvent({action:"unregister-power-up",data:{id:t}})},i={id:t,enabled:!0,setEnabled:n=>{const c=this.powerUps.find(d=>d.id===t);c&&c.enabled!==n&&(c.enabled=n,n?o():s())},destroy:()=>{this.powerUps.splice(this.powerUps.findIndex(n=>n.id===t),1),s()},handler:e.handler};return this.powerUps.push(i),o(),i}async callPowerUp({id:e,callId:t,args:o}){const s=this.powerUps.find(i=>i.id===e);if(s)if(!s.enabled)console.warn("ChatThing: power up disabled");else if(s.handler){let i;try{i=await s.handler(o),i??(i="success")}catch(n){i=n}this.sendMessageEvent({action:"response-power-up",data:{callId:t,response:JSON.parse(JSON.stringify(i))}})}else console.error("power up has no handler");else console.error("power up destroyed")}reload(){const e=[[this.chatWindowParent,this.chatWindow],[document.body,this.messagePreview]];this.customTrigger||e.unshift([document.body,this.trigger]);for(const[t,o]of e)t&&o&&t.removeChild(o);window.removeEventListener("message",this.receiveMessageEvent),a.chatThing=void 0,a.chatThing=new w}create(){var e,t;this.chatWindow||(sessionStorage.setItem("showMessageBubble","true"),this.chatWindow=document.createElement("div"),this.chatWindow.style.cssText=((e=this.config.css)==null?void 0:e.window)||"",this.chatWindow.setAttribute("data-cy","window-chatthing"),this.chatFrame.src=`${this.config.url}/${this.localePrefix}bots/${this.config.botId}/sdk${this.config.initialQuestion?`?initialQuestion=${encodeURIComponent(this.config.initialQuestion)}`:""}`,this.chatFrame.setAttribute("frameborder","0"),this.chatFrame.setAttribute("allow","clipboard-write *; microphone;"),this.chatFrame.style.cssText=((t=this.config.css)==null?void 0:t.iframe)||"",this.chatWindow.appendChild(this.chatFrame),this.chatWindowParent.appendChild(this.chatWindow))}sendMessageEvent(e){var t;this.interfaceReady?(t=this.chatFrame.contentWindow)==null||t.postMessage({destination:"chat-thing",payload:e},"*"):this.payloads.push(e)}receiveMessageEvent(e){const{data:t}=e;t.destination==="chat-thing"&&(t.payload.action==="interface-ready"&&!this.interfaceReady?(this.interfaceReady=!0,this.payloads.map(o=>{var s;(s=this.chatFrame.contentWindow)==null||s.postMessage({destination:"chat-thing",payload:o},"*")})):t.payload.action==="call-power-up"?this.callPowerUp(t.payload.data):t.payload.action==="close"&&this.open&&this.toggle())}updateTriggerState(e){var t,o,s,i;if(this.customTrigger){this.trigger.setAttribute("aria-pressed",e?"true":"false");return}if(this.trigger.textContent="",e){const n=this.parser.parseFromString((t=this.config.svg)==null?void 0:t.close,"image/svg+xml");this.trigger.appendChild(n.children[0]),this.trigger.setAttribute("aria-pressed","true")}else{if((o=this.config.icon)!=null&&o.widgetIcon){const n=document.createElement("img");n.src=this.config.icon.widgetIcon,n.style.cssText=(s=this.config.css)==null?void 0:s.customAssistantIcon,this.trigger.appendChild(n)}else{const n=this.parser.parseFromString((i=this.config.svg)==null?void 0:i.widget,"image/svg+xml");this.trigger.appendChild(n.children[0])}this.trigger.setAttribute("aria-pressed","false")}}createPreview(e){var d,p,m,f,u,x,b,y,P,C,T;this.messagePreview=document.createElement("div"),this.messagePreview.style.cssText=(d=this.config.css)==null?void 0:d.messagePreviewContainer,document.body.appendChild(this.messagePreview);const t=this.parser.parseFromString((p=this.config.svg)==null?void 0:p.close,"image/svg+xml"),o=t.children[0];o instanceof SVGElement&&(o.style.cssText=(m=this.config.css)==null?void 0:m.messagePreviewCloseIcon);const s=document.createElement("button");s.style.cssText=(f=this.config.css)==null?void 0:f.messagePreviewCloseButton,this.isTouchDevice()||(s.style.visibility="hidden",s.style.opacity="0"),s.appendChild(t.children[0]),s.setAttribute("aria-label","close chat message"),this.messagePreview.appendChild(s);const i=document.createElement("div");i.style.cssText=(u=this.config.css)==null?void 0:u.messagePreviewBox,i.setAttribute("role","alert"),this.messagePreview.appendChild(i);const n=document.createElement("div");i.appendChild(n);const c=document.createElement("div");if(c.style.cssText=(x=this.config.css)==null?void 0:x.messagePreviewIconWrapper,n.appendChild(c),(b=this.config.icon)!=null&&b.widgetIcon){const l=document.createElement("img");l.src=this.config.icon.widgetIcon,l.style.cssText=(y=this.config.css)==null?void 0:y.bubbleCustomAssistantIcon,c.appendChild(l)}else{const l=this.parser.parseFromString((P=this.config.svg)==null?void 0:P.widget,"image/svg+xml"),I=l.children[0];I instanceof SVGElement&&(I.style.cssText=(C=this.config.css)==null?void 0:C.messagePreviewIconImg),c.appendChild(l.children[0])}this.messagePreviewText.style.cssText=(T=this.config.css)==null?void 0:T.messagePreviewText,this.messagePreviewText.textContent=e,i.appendChild(this.messagePreviewText),i.addEventListener("click",()=>{this.toggle()}),this.messagePreview.addEventListener("mouseover",()=>{s.style.visibility="visible",s.style.opacity="1"}),this.messagePreview.addEventListener("mouseleave",()=>{s.style.visibility="hidden",s.style.opacity="0"}),s.addEventListener("click",()=>{sessionStorage.setItem("showMessageBubble","true"),this.slidePreviewOut()})}slidePreviewIn(){this.messagePreview&&(this.messagePreview.style.transform="translateX(0)",this.messagePreviewVisible=!0)}slidePreviewOut(){this.messagePreview&&(this.messagePreview.style.transform="translateX(350px)",this.messagePreviewVisible=!1)}get localePrefix(){return this.config.locale&&this.locales.includes(this.config.locale)?this.config.locale+"/":""}isTouchDevice(){return!!("ontouchstart"in window||navigator.maxTouchPoints)}_extendContext(e){const t={};if(e!=null&&e.pageMeta&&(t.pageMeta=this.loadPageMeta()),e!=null&&e.custom&&(t.custom=e.custom),e!=null&&e.markdown&&(t.markdown=e.markdown),e!=null&&e.dataAttributes){const o=document.querySelectorAll("[data-chat-thing-context]");if(o.length)for(const s of o){const i=s.dataset.chatThingContext;i?(t.custom??(t.custom={}),t.custom[i]=s.innerText):console.warn("ChatThing: missing context identifier")}}this.extendContext(t)}loadPageMeta(){var n,c,d,p,m,f,u;const e=(n=document.querySelector("title"))==null?void 0:n.innerText,t=(d=(c=document.querySelector('meta[name="description"]'))==null?void 0:c.getAttribute("content"))==null?void 0:d.trim(),o=(m=(p=document.querySelector('meta[property="og:title"]'))==null?void 0:p.getAttribute("content"))==null?void 0:m.trim(),s=(u=(f=document.querySelector('meta[property="og:description"]'))==null?void 0:f.getAttribute("content"))==null?void 0:u.trim(),i={url:location.href};return e&&(i.title=e),t&&(i.description=t),o&&(i["og:title"]=o),s&&(i["og:description"]=s),i}}return a.chatThing&&console.warn("chat thing api already present; has the embed script been included more than once?"),a.chatThing=new w,a.chatThing}();
